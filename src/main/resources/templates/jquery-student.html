<!doctype html>
<html lang="en">

<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
		integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

	<title>Hello, world!</title>
</head>

<body>
	<br><br><br>
	<h1 class="text-danger text-center">STUDENT DETAILS</h1>
	<br><br><br>


	<div class="container">
		<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"
			data-whatever="@getbootstrap">ADD STUDENT</button>
		<br><br>
		<table class="table table-bordered">
			<thead>
				<tr>
					<th scope="col">NAME</th>
					<th scope="col">SURNAME</th>
					<th scope="col">ROLLNO</th>
					<th scope="col">STUDENTID</th>
					<th scope="col">SCHOOL</th>
					<th scope="col">AGE</th>
					<th scope="col">ACTION</th>
				</tr>
			</thead>
			<tbody id="myTable">

			</tbody>
		</table>
	</div>

	<!-- Add Student modal start-->

	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">New message</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="insert">
						<div class="form-group">
							<label for="recipient-name" class="col-form-label">Name:</label>
							<input type="text" class="form-control" id="add-name" name="name">
						</div>

						<div class="form-group">
							<label for="message-text" class="col-form-label">SURNAME :</label>
							<input type="text" class="form-control" id="add-surname" name="surname">
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">ROLLNO :</label>
							<input type="text" class="form-control" id="add-rollno" name="rollno">
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">STUDENTID :</label>
							<input type="text" class="form-control" id="add-studentid" name="studentid">
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">SCHOOL :</label>
							<input type="text" class="form-control" id="add-school" name="school">
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">AGE :</label>
							<input type="text" class="form-control" id="add-age" name="age">
						</div>


						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="submit" class="btn btn-primary">Submit</button>
						</div>
					</form>
				</div>

			</div>
		</div>
	</div>

	<!-- Add Student modal end -->

	<!-- Edit Student modal start -->

	<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
		aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">EDIT STUDENT</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="updateBtn">
						<div class="form-group">
							<label for="recipient-name" class="col-form-label">Name:</label>
							<input type="text" class="form-control" id="edit-name" name="name">
							<input type="hidden" id="edit-id" class="id">
						</div>

						<div class="form-group">
							<label for="message-text" class="col-form-label">SURNAME :</label>
							<input type="text" class="form-control" id="edit-surname" name="surname">
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">ROLLNO :</label>
							<input type="text" class="form-control" id="edit-rollno" name="rollno">
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">STUDENTID :</label>
							<input type="text" class="form-control" id="edit-studentid" name="studentid">
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">SCHOOL :</label>
							<input type="text" class="form-control" id="edit-school" name="school">
						</div>
						<div class="form-group">
							<label for="message-text" class="col-form-label">AGE :</label>
							<input type="text" class="form-control" id="edit-age" name="age">
						</div>


						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="submit" class="btn btn-primary updateBtn"
								data="' + data[i].id + '">Update</button>
						</div>
					</form>
				</div>

			</div>
		</div>
	</div>

	<!-- Edit Student modal end -->

	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
		integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script>

		$(document).ready(function () {

			getTableData();

		});

		function getTableData() {

			$.ajax({
				type: "GET",
				contentType: "application/json",
				url: "/student/readstudent", //we have not use id in controller then no need to give id.
				//data: JSON.stringify(emp),
				dataType: 'json',
				cache: false,

				success: function (data) {

					var tableValue = '';

					for (var i = 0; i < data.length; i++) {

						console.log(data[i])
						tableValue += '<tr>'
							+ '<td>' + data[i].name + '</td>'
							+ '<td>' + data[i].surname + '</td>'
							+ '<td>' + data[i].rollno + '</td>'
							+ '<td>' + data[i].studentid + '</td>'
							+ '<td>' + data[i].school + '</td>'
							+ '<td>' + data[i].age + '</td>'
							+ '<td>' + '<button type="button" id="xyz"  data=' + data[i].id + ' class="btn btn-primary getByIdBtn"  data-toggle="modal" data-target="#editModal">EDIT</button>  <button type="button" class="btn btn-danger deleteBtn" id="abc"  data=' + data[i].id + '  data-bs-target="#deleteModal"   > DELETE </button>' + '</td>'
					}

					$('#myTable').html(tableValue);
				},
				error: function (e) {
					alert('error')
				}

			});
		}

		$(document).on('submit', '#insert', function (e) {

			e.preventDefault();// to prevent the default form submission behavior and handle it yourself using JavaScript.

			var stud =
			{
				"name": $('#add-name').val(),
				"surname": $('#add-surname').val(),
				"rollno": $('#add-rollno').val(),
				"studentid": $('#add-studentid').val(),
				"school": $('#add-school').val(),
				"age": $('#add-age').val()
			}

			$.ajax({
				type: "POST",
				contentType: "application/json",
				url: "/student/addstudent",
				data: JSON.stringify(stud),
				dataType: 'json',
				//cache: false,

				success: function (data) {

					alert('saved!')
				},
				error: function (e) {

					alert('error')
				}
			});

		});
                                                                                             //delete
		$(document).on('click', '#abc', function (e) {

			var id = $(this).attr('data');


			$.ajax({
				type: "DELETE",
				contentType: "application/json",
				url: "/student/deletestudent/" + id,
				//data: JSON.stringify(prod),
				//dataType: 'json',
				cache: false,
				success: function (data) {

					getTableData();  //with the help of this functon we got response
					alert('deleted')

				}, error: function (e) {

					alert('error')
				}
			});

		});
		$(document).on('click', '#xyz', function (e) {

			var id = $(this).attr('data');

			$.ajax({
				type: "GET",
				contentType: "application/json",
				url: "/student/read/" + id,
				//data: JSON.stringify(emp),
				dataType: 'json',
				cache: false,

				success: function (data) {


					$('#edit-id').val(data.id);
					$('#edit-name').val(data.name);
					$('#edit-surname').val(data.surname);
					$('#edit-rollno').val(data.rollno);
					$('#edit-studentid').val(data.studentid);
					$('#edit-school').val(data.school);
					$('#edit-age').val(data.age);
				},

				error: function (e) {

					alert('error comes');
				}
			});
		});

		$(document).on('submit', '#updateBtn', function (e) {
			e.preventDefault();
			
			var stud =
			{
				"id": $('#edit-id').val(),
				"name": $('#edit-name').val(),
				"surname": $('#edit-surname').val(),
				"rollno": $('#edit-rollno').val(),
				"studentid": $('#edit-studentid').val(),
				"school": $('#edit-school').val(),
				"age": $('#edit-age').val()
			}

			$.ajax({
				type: "POST",
				contentType: "application/json",
				url: "/student/addstudent",
				data: JSON.stringify(stud),
				dataType: 'json',
				//cache: false,

				success: function (data) {

					alert('Update!')
				},
				error: function (e) {

					alert('error')
				}
			});

		});
	</script>
</body>

</html>